<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="ui.title">markdown/latex在线翻译工具</title>
    <link rel="stylesheet" href="style.css">
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@4/tex-mml-chtml.js"></script>
    <script>
        window.MathJax = {
            loader: { load: ['[tex]/bboldx'] },
            tex: {
                packages: { '[+]': ['bboldx'] },
                inlineMath: [['$', '$']],
                displayMath: [['$$', '$$']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
                ignoreHtmlClass: 'tex2jax_ignore',
                processHtmlClass: 'tex2jax_process'
            },
            startup: {
                ready: function () {
                    MathJax.startup.defaultReady();
                }
            }
        };
    </script>
</head>

<body>
    <div class="app-container">
        <!-- 左侧设置栏 -->
        <div class="settings-panel" id="settings-panel">

            <div class="settings-header">
                <h2 data-i18n="ui.settings">设置</h2>
                <button class="collapse-btn" id="collapse-btn">‹</button>
            </div>

            <div class="setting-group">
                <label for="interface-language" data-i18n="ui.settingsPanel.language">界面语言:</label>
                <select id="interface-language">
                    <option value="zh-CN">中文</option>
                    <option value="en-US">English</option>
                </select>
            </div>

            <!-- 常规设置折叠区域 -->
            <div class="settings-section">
                <div class="settings-section-header" onclick="toggleSettingsSection('general-settings')">
                    <span data-i18n="ui.settingsPanel.generalSettings">常规</span>
                    <span class="section-toggle">▼</span>
                </div>
                <div id="general-settings" class="settings-section-content">
                    <div class="setting-group">
                        <label for="api-provider" data-i18n="ui.settingsPanel.apiProvider">API提供商:</label>
                        <select id="api-provider">
                            <option value="ollama" data-i18n="messages.apiProviders.ollama">Ollama</option>
                            <option value="openai" data-i18n="messages.apiProviders.openai">OpenAI</option>
                            <option value="anthropic" data-i18n="messages.apiProviders.anthropic">Anthropic</option>
                            <option value="custom" data-i18n="ui.settingsPanel.custom">自定义</option>
                        </select>
                    </div>

                    <div class="setting-group">
                        <label for="model-name" data-i18n="ui.settingsPanel.modelName">模型名称:</label>
                        <input type="text" id="model-name" data-i18n-placeholder="ui.settingsPanel.modelNamePlaceholder" placeholder="请输入模型名称">
                    </div>

                    <div class="setting-group">
                        <label for="api-endpoint" data-i18n="ui.settingsPanel.apiEndpoint">API端点:</label>
                        <input type="text" id="api-endpoint" data-i18n-placeholder="ui.settingsPanel.apiEndpointPlaceholder" placeholder="请输入API端点URL">
                    </div>

                    <div class="setting-group">
                        <label for="api-key" data-i18n="ui.settingsPanel.apiKey">API Key:</label>
                        <input type="password" id="api-key" data-i18n-placeholder="ui.settingsPanel.apiKeyPlaceholder" placeholder="请输入您的API Key">
                    </div>

                    <div class="setting-group">
                        <label for="temperature" data-i18n="ui.settingsPanel.temperature">Temperature:</label>
                        <input type="number" id="temperature" min="0" max="2" step="0.1" data-i18n-placeholder="ui.settingsPanel.temperaturePlaceholder" placeholder="留空使用默认值">
                        <small class="setting-hint" data-i18n="ui.settingsPanel.temperatureHint">控制输出随机性，0.0-2.0，留空则不设置（建议降低一些temperature）</small>
                    </div>

                    <div class="setting-group">
                        <label for="translation-prompt" data-i18n="ui.settingsPanel.translationPrompt">翻译提示词:</label>
                        <textarea id="translation-prompt" rows="6"
                            data-i18n-placeholder="ui.settingsPanel.translationPromptPlaceholder" placeholder="请将以下文本翻译成中文，保持原文的格式和结构...">请将以下文本翻译成中文，保持原文的格式和结构，不要添加额外的解释或注释。</textarea>
                    </div>

                    <div class="setting-group">
                        <label for="context-count" data-i18n="ui.settingsPanel.contextCount">上下文数量:</label>
                        <input type="number" id="context-count" min="0" max="5" value="0">
                        <small class="setting-hint" data-i18n="ui.settingsPanel.contextCountHint">提供前文以提升翻译准确性，留空则不提供（对于小模型推荐设置为0）</small>
                    </div>

                    <div class="setting-group">
                        <button id="translate-all-btn" class="btn btn-primary btn-full-width" disabled data-i18n="ui.buttons.translateAll">全部翻译</button>
                    </div>
                    <div class="setting-group">
                        <button id="export-alternating-btn" class="btn btn-secondary btn-full-width" disabled data-i18n="ui.buttons.exportAlternating">导出交替翻译结果</button>
                    </div>
                </div>
            </div>

            <!-- 操作设置折叠区域 -->
            <div class="settings-section">
                <div class="settings-section-header" onclick="toggleSettingsSection('proofread-settings')">
                    <span data-i18n="ui.settingsPanel.proofreadSettings">校对</span>
                    <span class="section-toggle">▼</span>
                </div>
                <div id="proofread-settings" class="settings-section-content">
                    <!-- 校对模式开关 -->
                    <div class="setting-group">
                        <label>
                            <input type="checkbox" id="proofreading-mode" />
                            <span data-i18n="ui.settingsPanel.proofreadingMode">启用校对模式</span>
                        </label>
                    </div>

                    <!-- 校对设置 -->
                    <div id="proofreading-settings-group" style="display: none;">
                        <div class="setting-group">
                            <label for="proofread-api-provider" data-i18n="ui.settingsPanel.proofreadApiProvider">校对API提供商:</label>
                            <select id="proofread-api-provider">
                                <option value="ollama" data-i18n="messages.apiProviders.ollama">Ollama</option>
                                <option value="openai" data-i18n="messages.apiProviders.openai">OpenAI</option>
                                <option value="anthropic" data-i18n="messages.apiProviders.anthropic">Anthropic</option>
                                <option value="custom" data-i18n="ui.settingsPanel.custom">自定义</option>
                            </select>
                        </div>

                        <div class="setting-group">
                            <label for="proofread-model-name" data-i18n="ui.settingsPanel.proofreadModelName">校对模型名称:</label>
                            <input type="text" id="proofread-model-name" data-i18n-placeholder="ui.settingsPanel.proofreadModelNamePlaceholder" placeholder="请输入校对模型名称">
                        </div>

                        <div class="setting-group">
                            <label for="proofread-api-endpoint" data-i18n="ui.settingsPanel.proofreadApiEndpoint">校对API端点:</label>
                            <input type="text" id="proofread-api-endpoint" data-i18n-placeholder="ui.settingsPanel.proofreadApiEndpointPlaceholder" placeholder="请输入校对API端点URL">
                        </div>

                        <div class="setting-group">
                            <label for="proofread-api-key" data-i18n="ui.settingsPanel.proofreadApiKey">校对API Key:</label>
                            <input type="password" id="proofread-api-key" data-i18n-placeholder="ui.settingsPanel.proofreadApiKeyPlaceholder" placeholder="请输入您的校对API Key">
                        </div>

                        <div class="setting-group">
                            <label for="proofread-temperature" data-i18n="ui.settingsPanel.proofreadTemperature">校对Temperature:</label>
                            <input type="number" id="proofread-temperature" min="0" max="2" step="0.1" data-i18n-placeholder="ui.settingsPanel.proofreadTemperaturePlaceholder" placeholder="留空使用默认值">
                            <small class="setting-hint" data-i18n="ui.settingsPanel.proofreadTemperatureHint">校对输出随机性，0.0-2.0，留空则不设置</small>
                        </div>

                        <div class="setting-group">
                            <label for="proofread-prompt" data-i18n="ui.settingsPanel.proofreadPrompt">校对提示词:</label>
                            <textarea id="proofread-prompt" rows="6"
                                data-i18n-placeholder="ui.settingsPanel.proofreadPromptPlaceholder" placeholder="请校对以下翻译内容...">请校对以下翻译内容，检查语法、用词、逻辑和流畅度，并给出改进建议。请直接输出改进后的内容，不要添加额外的解释或注释。</textarea>
                        </div>

                        <div class="setting-group">
                            <label for="proofread-batch-size" data-i18n="ui.settingsPanel.proofreadBatchSize">单次校对段落数量:</label>
                            <input type="number" id="proofread-batch-size" min="1" max="500" value="5">
                            <small class="setting-hint" data-i18n="ui.settingsPanel.proofreadBatchSizeHint">一次校对的文本块数量，默认为10</small>
                        </div>

                        <div class="setting-group">
                            <button id="proofread-all-btn" class="btn btn-primary btn-full-width" disabled data-i18n="ui.buttons.proofreadAll">校对所有段落</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 主内容区域 -->
        <div class="main-content-panel">
            <div class="content-header">
                <div class="header-left">
                    <div class="file-info" id="file-info"></div>
                </div>
                <div class="header-right">
                    <button id="upload-btn" class="btn btn-primary" data-i18n="ui.buttons.uploadFile">上传Markdown文件</button>
                    <input type="file" id="file-input" accept=".md,.markdown" style="display: none;">
                    <button id="export-btn" class="btn btn-secondary" disabled data-i18n="ui.buttons.exportTranslation">导出翻译结果</button>
                </div>
            </div>
            <div class="content-container" id="content-container">
                <div class="placeholder">
                    <p data-i18n="ui.placeholders.uploadPrompt">请上传Markdown文件开始翻译</p>
                </div>
            </div>
        </div>
    </div>

    <!-- 模态框用于显示错误信息 -->
    <div id="error-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3 data-i18n="ui.modal.error">错误</h3>
            <p id="error-message"></p>
        </div>
    </div>

    <script src="language-manager.js"></script>
    <script>
        // 折叠设置部分的JavaScript函数
        function toggleSettingsSection(sectionId) {
            const content = document.getElementById(sectionId);
            const header = content.previousElementSibling;
            const toggle = header.querySelector('.section-toggle');
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                toggle.textContent = '▼';
            } else {
                content.style.display = 'none';
                toggle.textContent = '▶';
            }
        }
        
        // 页面加载时展开常规设置部分
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('general-settings').style.display = 'block';
        });
    </script>
    <script src="app.js"></script>
</body>

</html>