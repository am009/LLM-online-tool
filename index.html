<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="ui.title">markdown/latex在线翻译工具</title>
    <link rel="stylesheet" href="common.css">
    <link rel="stylesheet" href="markdown-translator.css">
    <link rel="stylesheet" href="pdfocr.css">
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@4/tex-mml-chtml.js"></script>
    <script>
        window.MathJax = {
            loader: { load: ['[tex]/bboldx'] },
            tex: {
                packages: { '[+]': ['bboldx'] },
                inlineMath: [['$', '$']],
                displayMath: [['$$', '$$']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
                ignoreHtmlClass: 'tex2jax_ignore',
                processHtmlClass: 'tex2jax_process'
            },
            startup: {
                ready: function () {
                    MathJax.startup.defaultReady();
                }
            }
        };
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
</head>

<body>
    <div class="container">
        <!-- 导航栏 -->
        <nav class="tab-navigation">
            <div class="tab-list">
                <button class="tab-button" data-tab="pdf-ocr" data-i18n="ui.tabs.pdfOcr">PDF OCR</button>
                <button class="tab-button active" data-tab="translation" data-i18n="ui.tabs.translation">Translation</button>
            </div>
            <div class="language-selector">
                <svg t="1758113779159" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1494" width="25" height="25" style="margin: 5px; fill: gray;"><path d="M928 512a416.192 416.192 0 0 1-287.936 395.904L640 1024l-128-128 128-128 0.064 72a352.256 352.256 0 0 0 223.616-312.96L864 512h64zM320 448v64h192v64H416c0 66.048-33.28 130.944-81.216 182.4 33.92 25.344 68.032 38.912 102.592 41.216L448 800v64c-56.704 0-110.464-20.928-161.408-62.08-46.848 35.584-100.032 58.688-147.968 61.76L128 864v-64c33.984 0 74.368-16.448 111.424-42.88a650.24 650.24 0 0 1-64-83.52l-10.624-16.704 54.4-33.792a616.128 616.128 0 0 0 68.288 91.904c34.944-37.312 60.48-82.816 64.064-128.064L352 576H64V512h192V448h64zM817.728 60.8L956.8 448h-89.984l-28.992-88.768h-140.8L668.544 448H579.008L720.768 60.8h96.96zM448 0l128 128-128 128V165.824A352.32 352.32 0 0 0 183.04 386.56l-5.12 14.08-60.672-20.224A416.256 416.256 0 0 1 448 100.928V0z m320.256 127.488h-2.24l-1.408 11.2c-1.28 7.36-3.008 14.592-5.376 21.568l-44.224 135.232h103.232l-43.968-134.208-1.984-6.912a176.512 176.512 0 0 1-4.032-26.88z" p-id="1495"></path></svg>
                <select id="interface-language" class="language-select">
                    <option value="zh-CN">中文</option>
                    <option value="en-US">English</option>
                </select>
            </div>
        </nav>

        <!-- Tab 内容容器 -->
        <div class="tab-content-wrapper">
            <!-- PDF OCR Tab -->
            <div id="pdf-ocr-content" class="tab-content">
                <!-- 左侧设置栏 -->
                <aside class="settings-panel" id="ocr-settings-panel">
                    <button class="collapse-btn" id="ocr-collapse-btn" title="折叠/展开">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="15 18 9 12 15 6"></polyline>
                        </svg>
                    </button>
                    <div class="settings-content">
                        <h2 data-i18n="ui.settings">设置</h2>
                        <div class="settings-section">
                            <h3 class="section-header" onclick="toggleSection(this)">
                                <svg class="section-toggle-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="6 9 12 15 18 9"></polyline>
                                </svg> <span data-i18n="ui.settingsPanel.apiSettings">API 设置</span>
                            </h3>
                            <div class="setting-group">
                                <label for="ocr-api-base" data-i18n="ui.settingsPanel.apiBaseUrl">API 基础 URL:</label>
                                <input type="text" id="ocr-api-base" class="form-control" value="http://172.19.193.39:5123" placeholder="http://172.19.193.39:5123">
                            </div>
                        </div>
                        <div class="settings-section">
                            <h3 class="section-header" onclick="toggleSection(this)">
                                <svg class="section-toggle-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="6 9 12 15 18 9"></polyline>
                                </svg> <span data-i18n="ui.settingsPanel.recognitionOptions">识别选项</span>
                            </h3>
                            <div class="setting-group">
                                <label class="checkbox-label" for="ocr-auto-scroll">
                                    <input type="checkbox" id="ocr-auto-scroll" checked>
                                    <span data-i18n="ui.settingsPanel.autoScrollToCurrentPage">自动识别时，滚动到当前识别页面</span>
                                </label>
                            </div>
                        </div>
                        <div class="settings-section">

                        </div>
                    </div>
                </aside>

                <!-- 主体OCR栏 -->
                <div class="main-content">
                    <header class="content-header">
                        <div class="header-left">
                            <h1 data-i18n="ui.tabs.pdfOcr">PDF OCR</h1>
                            <span id="ocr-file-info" data-i18n="ui.placeholders.noFileSelected">未选择文件</span>
                            <span id="ocr-page-count"></span>
                        </div>
                        <div class="header-right">
                            <input type="file" id="ocr-pdf-input" accept=".pdf" style="display: none;">
                            <button class="btn btn-primary" onclick="document.getElementById('ocr-pdf-input').click()" data-i18n="ui.buttons.selectPdf">
                                选择 PDF
                            </button>
                            <input type="file" id="ocr-progress-input" accept=".json" style="display: none;">
                            <button class="btn btn-secondary" id="ocr-load-progress-btn" onclick="document.getElementById('ocr-progress-input').click()" data-i18n="ui.buttons.loadProgress">
                                加载进度
                            </button>
                            <button class="btn btn-secondary" id="ocr-save-progress-btn" data-i18n="ui.buttons.saveProgress">
                                保存进度
                            </button>
                            <button class="btn btn-secondary" id="ocr-export-btn" disabled data-i18n="ui.buttons.exportMarkdown">
                                导出markdown
                            </button>
                            <button class="btn btn-primary" id="ocr-recognize-all-btn">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
                                    <polyline points="14 2 14 8 20 8"/>
                                    <line x1="16" y1="13" x2="8" y2="13"/>
                                    <line x1="16" y1="17" x2="8" y2="17"/>
                                    <polyline points="10 9 9 9 8 9"/>
                                </svg>
                                <span data-i18n="ui.buttons.recognizeAll">识别所有</span>
                            </button>
                            
                        </div>
                    </header>

                    <!-- 批量识别进度 -->
                    <span class="progress-info" id="ocr-progress-info"></span>

                    <!-- 页面列表区域 -->
                    <div class="vertical-container" id="ocr-pages-container">
                        <div class="empty-state">
                            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                <path d="M13 3v5a2 2 0 002 2h4"/>
                            </svg>
                            <p data-i18n="ui.placeholders.selectPdfPrompt">请选择 PDF 文件开始</p>
                            <button class="btn btn-primary" onclick="document.getElementById('ocr-pdf-input').click()" data-i18n="ui.buttons.selectPdfFile">
                                选择 PDF 文件
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Translation Tab -->
            <div id="translation-content" class="tab-content active">
                <!-- 左侧设置栏 -->
                <aside class="settings-panel" id="translation-settings-panel">
                    <button class="collapse-btn" id="translation-collapse-btn" title="折叠/展开">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="15 18 9 12 15 6"></polyline>
                        </svg>
                    </button>

                    <div class="settings-content">
                        <h2 data-i18n="ui.settings">设置</h2>

                        <!-- 分段设置折叠区域 -->
                        <div class="settings-section">
                            <h3 class="section-header" onclick="toggleSection(this)">
                                <svg class="section-toggle-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="6 9 12 15 18 9"></polyline>
                                </svg>
                                <span data-i18n="ui.settingsPanel.paragraphSettings">分段</span>
                            </h3>
                            <div id="translation-paragraph-settings" class="section-content">
                                <div class="setting-group">
                                    <label for="translation-paragraph-char-limit" data-i18n="ui.settingsPanel.paragraphCharLimit">单段字符数:</label>
                                    <input type="number" id="translation-paragraph-char-limit" min="0" value="0">
                                    <small class="setting-hint" data-i18n="ui.settingsPanel.paragraphCharLimitHint">设置为0表示不限制，大于0时会合并段落以减少API调用</small>
                                </div>

                                <div class="setting-group">
                                    <button id="translation-reorganize-paragraphs-btn" class="btn btn-secondary btn-full-width" disabled data-i18n="ui.buttons.reorganizeParagraphs">重新划分段落</button>
                                </div>
                            </div>
                        </div>

                        <!-- 翻译设置折叠区域 -->
                        <div class="settings-section">
                            <h3 class="section-header" onclick="toggleSection(this)">
                                <svg class="section-toggle-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="6 9 12 15 18 9"></polyline>
                                </svg>
                                <span data-i18n="ui.settingsPanel.translationSettings">翻译</span>
                            </h3>
                            <div id="translation-general-settings" class="section-content">
                                <div class="setting-group">
                                    <label for="translation-api-provider" data-i18n="ui.settingsPanel.apiProvider">API提供商:</label>
                                    <select id="translation-api-provider">
                                        <option value="ollama" data-i18n="messages.apiProviders.ollama">Ollama</option>
                                        <option value="openai" data-i18n="messages.apiProviders.openai">OpenAI</option>
                                        <option value="anthropic" data-i18n="messages.apiProviders.anthropic">Anthropic</option>
                                        <option value="custom" data-i18n="ui.settingsPanel.custom">自定义</option>
                                    </select>
                                </div>

                                <div class="setting-group">
                                    <label for="translation-model-name" data-i18n="ui.settingsPanel.modelName">模型名称:</label>
                                    <input type="text" id="translation-model-name" data-i18n-placeholder="ui.settingsPanel.modelNamePlaceholder" placeholder="请输入模型名称">
                                </div>

                                <div class="setting-group">
                                    <label for="translation-api-endpoint" data-i18n="ui.settingsPanel.apiEndpoint">API端点:</label>
                                    <input type="text" id="translation-api-endpoint" data-i18n-placeholder="ui.settingsPanel.apiEndpointPlaceholder" placeholder="请输入API端点URL">
                                </div>

                                <div class="setting-group">
                                    <label for="translation-api-key" data-i18n="ui.settingsPanel.apiKey">API Key:</label>
                                    <input type="password" id="translation-api-key" data-i18n-placeholder="ui.settingsPanel.apiKeyPlaceholder" placeholder="请输入您的API Key">
                                </div>

                                <div class="setting-group">
                                    <label for="translation-temperature" data-i18n="ui.settingsPanel.temperature">Temperature:</label>
                                    <input type="number" id="translation-temperature" min="0" max="2" step="0.1" data-i18n-placeholder="ui.settingsPanel.temperaturePlaceholder" placeholder="留空使用默认值">
                                    <small class="setting-hint" data-i18n="ui.settingsPanel.temperatureHint">控制输出随机性，0.0-2.0，留空则不设置（建议降低一些temperature）</small>
                                </div>

                                <div class="setting-group">
                                    <label>
                                        <input type="checkbox" id="translation-enable-thinking" />
                                        <span data-i18n="ui.settingsPanel.enableThinking">启用thinking</span>
                                    </label>
                                    <small class="setting-hint" data-i18n="ui.settingsPanel.enableThinkingHint">为支持的API提供商启用thinking功能（如Ollama）</small>
                                </div>

                                <div class="setting-group">
                                    <label for="translation-prompt" data-i18n="ui.settingsPanel.translationPrompt">翻译提示词:</label>
                                    <textarea id="translation-prompt" rows="6"
                                        data-i18n-placeholder="ui.settingsPanel.translationPromptPlaceholder" placeholder="请将以下文本翻译成中文，保持原文的格式和结构...">请将以下文本翻译成中文，保持原文的格式和结构，不要添加额外的解释或注释。</textarea>
                                </div>

                                <div class="setting-group">
                                    <label for="translation-context-count" data-i18n="ui.settingsPanel.contextCount">上下文数量:</label>
                                    <input type="number" id="translation-context-count" min="0" max="5" value="0">
                                    <small class="setting-hint" data-i18n="ui.settingsPanel.contextCountHint">提供前文以提升翻译准确性，留空则不提供（对于小模型推荐设置为0）</small>
                                </div>

                                <div class="setting-group">
                                    <button id="translate-all-btn" class="btn btn-primary btn-full-width" disabled data-i18n="ui.buttons.translateAll">全部翻译</button>
                                </div>
                                <div class="setting-group">
                                    <button id="translation-export-alternating-btn" class="btn btn-secondary btn-full-width" disabled data-i18n="ui.buttons.exportAlternating">导出交替翻译结果</button>
                                </div>
                            </div>
                        </div>

                        <!-- 操作设置折叠区域 -->
                        <div class="settings-section">
                            <h3 class="section-header" onclick="toggleSection(this)">
                                <svg class="section-toggle-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="6 9 12 15 18 9"></polyline>
                                </svg>
                                <span data-i18n="ui.settingsPanel.proofreadSettings">校对</span>
                            </h3>
                            <div id="proofread-settings" class="section-content">
                                <!-- 校对模式开关 -->
                                <div class="setting-group">
                                    <label>
                                        <input type="checkbox" id="proofreading-mode" />
                                        <span data-i18n="ui.settingsPanel.proofreadingMode">启用校对模式</span>
                                    </label>
                                </div>

                                <!-- 校对设置 -->
                                <div id="proofreading-settings-group" style="display: none;">
                                    <div class="setting-group">
                                        <label for="proofread-api-provider" data-i18n="ui.settingsPanel.proofreadApiProvider">校对API提供商:</label>
                                        <select id="proofread-api-provider">
                                            <option value="ollama" data-i18n="messages.apiProviders.ollama">Ollama</option>
                                            <option value="openai" data-i18n="messages.apiProviders.openai">OpenAI</option>
                                            <option value="anthropic" data-i18n="messages.apiProviders.anthropic">Anthropic</option>
                                            <option value="custom" data-i18n="ui.settingsPanel.custom">自定义</option>
                                        </select>
                                    </div>

                                    <div class="setting-group">
                                        <label for="proofread-model-name" data-i18n="ui.settingsPanel.proofreadModelName">校对模型名称:</label>
                                        <input type="text" id="proofread-model-name" data-i18n-placeholder="ui.settingsPanel.proofreadModelNamePlaceholder" placeholder="请输入校对模型名称">
                                    </div>

                                    <div class="setting-group">
                                        <label for="proofread-api-endpoint" data-i18n="ui.settingsPanel.proofreadApiEndpoint">校对API端点:</label>
                                        <input type="text" id="proofread-api-endpoint" data-i18n-placeholder="ui.settingsPanel.proofreadApiEndpointPlaceholder" placeholder="请输入校对API端点URL">
                                    </div>

                                    <div class="setting-group">
                                        <label for="proofread-api-key" data-i18n="ui.settingsPanel.proofreadApiKey">校对API Key:</label>
                                        <input type="password" id="proofread-api-key" data-i18n-placeholder="ui.settingsPanel.proofreadApiKeyPlaceholder" placeholder="请输入您的校对API Key">
                                    </div>

                                    <div class="setting-group">
                                        <label for="proofread-temperature" data-i18n="ui.settingsPanel.proofreadTemperature">校对Temperature:</label>
                                        <input type="number" id="proofread-temperature" min="0" max="2" step="0.1" data-i18n-placeholder="ui.settingsPanel.proofreadTemperaturePlaceholder" placeholder="留空使用默认值">
                                        <small class="setting-hint" data-i18n="ui.settingsPanel.proofreadTemperatureHint">校对输出随机性，0.0-2.0，留空则不设置</small>
                                    </div>

                                    <div class="setting-group">
                                        <label>
                                            <input type="checkbox" id="proofread-enable-thinking" />
                                            <span data-i18n="ui.settingsPanel.proofreadEnableThinking">启用校对thinking</span>
                                        </label>
                                        <small class="setting-hint" data-i18n="ui.settingsPanel.proofreadEnableThinkingHint">为支持的API提供商启用thinking功能（如Ollama）</small>
                                    </div>

                                    <div class="setting-group">
                                        <label for="proofread-prompt" data-i18n="ui.settingsPanel.proofreadPrompt">校对提示词:</label>
                                        <textarea id="proofread-prompt" rows="6"
                                            data-i18n-placeholder="ui.settingsPanel.proofreadPromptPlaceholder" placeholder="请校对以下翻译内容...">请校对以下翻译内容，检查语法、用词、逻辑和流畅度，并给出改进建议。请直接输出改进后的内容，不要添加额外的解释或注释。</textarea>
                                    </div>


                                    <div class="setting-group">
                                        <button id="proofread-all-btn" class="btn btn-primary btn-full-width" disabled data-i18n="ui.buttons.proofreadAll">校对所有段落</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>

                </aside>

                <!-- 主内容区域 -->
                <div class="main-content">
                    <div class="content-header">
                        <div class="header-left">
                            <h1 data-i18n="ui.tabs.translation">Translation</h1>
                            <div class="translation-file-info" id="translation-file-info" data-i18n="ui.placeholders.noFileSelected">未选择文件</div>
                        </div>
                        <div class="header-right">
                            <button id="translation-upload-btn" class="btn btn-primary" data-i18n="ui.buttons.uploadOriginal">上传原文</button>
                            <input type="file" id="translation-file-input" accept=".md,.markdown" style="display: none;">
                            <button id="translation-load-progress-btn" class="btn btn-secondary" data-i18n="ui.buttons.loadProgress">加载进度</button>
                            <button id="translation-save-progress-btn" class="btn btn-secondary" disabled data-i18n="ui.buttons.saveProgress">保存进度</button>
                            <input type="file" id="translation-progress-input" accept=".json" style="display: none;">
                            <button id="translation-export-original-btn" class="btn btn-secondary" disabled data-i18n="ui.buttons.exportOriginal">导出原文</button>
                            <button id="translation-export-btn" class="btn btn-primary" disabled data-i18n="ui.buttons.exportTranslation">导出译文</button>
                        </div>
                    </div>
                    <div class="vertical-container" id="translation-content-container">
                        <div class="placeholder">
                            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                <path d="M13 3v5a2 2 0 002 2h4"/>
                            </svg>
                            <p data-i18n="ui.placeholders.selectPrompt">请选择Markdown/Latex文件以开始翻译</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 模态框用于显示错误信息 -->
    <div id="error-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3 data-i18n="ui.modal.error">错误</h3>
            <p id="error-message"></p>
        </div>
    </div>

    <script src="language-manager.js"></script>
    <script src="common.js"></script>
    <script>
        // Tab切换功能
        function initTabNavigation() {
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');

            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const targetTab = button.getAttribute('data-tab');

                    // 移除所有active状态
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    tabContents.forEach(content => content.classList.remove('active'));

                    // 添加当前tab的active状态
                    button.classList.add('active');
                    const targetContent = document.getElementById(`${targetTab}-content`);
                    if (targetContent) {
                        targetContent.classList.add('active');
                    }
                });
            });
        }

        // 折叠设置部分的JavaScript函数
        function toggleSection(headerElement) {
            const isCollapsed = headerElement.classList.contains('collapsed');
            const sectionContent = headerElement.nextElementSibling;
            
            if (isCollapsed) {
                headerElement.classList.remove('collapsed');
                sectionContent.classList.remove('collapsed');
            } else {
                headerElement.classList.add('collapsed');
                sectionContent.classList.add('collapsed');
            }
        }
        
        // 页面加载时初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化tab导航
            initTabNavigation();
            
            // 展开常规设置部分
            document.getElementById('translation-general-settings').style.display = 'block';
        });
    </script>
    <script src="markdown-translator.js"></script>
    <script src="pdfocr.js"></script>
</body>

</html>